<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¶–≤–µ—Ç–æ—á–Ω–∞—è –õ–∞–≤–∫–∞</title>
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script defer src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto',sans-serif;background:#f5f5f5;}
    .card{background:#fff;border:1px solid #e5e5e5;transition:all 0.3s;}
    .card:hover{box-shadow:0 4px 12px rgba(0,0,0,0.08);border-color:#999;}
    .btn-black{background:#000;color:#fff;transition:all 0.3s;}
    .btn-black:hover{background:#333;}
    .category-scroll{overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;}
    .category-scroll::-webkit-scrollbar{display:none;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .animate-fadeIn{animation:fadeIn 0.3s ease-out}
    .animate-slideUp{animation:slideUp 0.3s ease-out}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const FlowerShop = () => {
      const [view, setView] = useState('catalog');
      const [lang, setLang] = useState('ru');
      const [products, setProducts] = useState([]);
      const [cart, setCart] = useState([]);
      const [orders, setOrders] = useState([]);
      const [customer, setCustomer] = useState(null);
      const [settings, setSettings] = useState(null);
      const [cashbackTransactions, setCashbackTransactions] = useState([]);
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [categories, setCategories] = useState([]);
      const [searchQuery, setSearchQuery] = useState('');
      const [useCashback, setUseCashback] = useState(false);
      const [cashbackAmount, setCashbackAmount] = useState(0);
      const [deliveryType, setDeliveryType] = useState('pickup'); // pickup –∏–ª–∏ delivery
      const [toast, setToast] = useState(null);
      const [loading, setLoading] = useState(true);
      const [supabase, setSupabase] = useState(null);

      const tg = window.Telegram?.WebApp;

      // –ü–µ—Ä–µ–≤–æ–¥—ã
      const translations = {
        ru: {
          catalog: '–ö–∞—Ç–∞–ª–æ–≥',
          cart: '–ö–æ—Ä–∑–∏–Ω–∞',
          orders: '–ó–∞–∫–∞–∑—ã',
          profile: '–ü—Ä–æ—Ñ–∏–ª—å',
          allCategories: '–í—Å–µ',
          name: '–ò–º—è',
          phone: '–¢–µ–ª–µ—Ñ–æ–Ω',
          comment: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π',
          total: '–ò—Ç–æ–≥–æ',
          order: '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
          addToCart: '–í –∫–æ—Ä–∑–∏–Ω—É',
          empty: '–ü—É—Å—Ç–æ',
          noOrders: '–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤',
          orderSuccess: '–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –ø—Ä–∏–¥—ë—Ç –≤ —á–∞—Ç üí¨',
          details: '–ü–æ–¥—Ä–æ–±–Ω–µ–µ',
          back: '–ù–∞–∑–∞–¥',
          cashback: '–ö—ç—à–±–µ–∫',
          balance: '–ë–∞–ª–∞–Ω—Å',
          history: '–ò—Å—Ç–æ—Ä–∏—è',
          useCashback: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–±–µ–∫',
          myProfile: '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å',
          totalOrders: '–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤',
          pickup: '–°–∞–º–æ–≤—ã–≤–æ–∑',
          delivery: '–î–æ—Å—Ç–∞–≤–∫–∞',
          address: '–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
          deliveryDate: '–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏',
          deliveryTime: '–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏',
          newItems: '–ù–æ–≤–∏–Ω–∫–∏'
        },
        kk: {
          catalog: '–ö–∞—Ç–∞–ª–æ–≥',
          cart: '–°–µ–±–µ—Ç',
          orders: '–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä',
          profile: '–ü—Ä–æ—Ñ–∏–ª—å',
          allCategories: '–ë–∞—Ä–ª—ã“ì—ã',
          name: '–ê—Ç—ã',
          phone: '–¢–µ–ª–µ—Ñ–æ–Ω',
          comment: '–¢“Ø—Å—ñ–Ω—ñ–∫—Ç–µ–º–µ',
          total: '–ë–∞—Ä–ª—ã“ì—ã',
          order: '–¢–∞–ø—Å—ã—Ä—ã—Å –±–µ—Ä—É',
          addToCart: '–°–µ–±–µ—Ç–∫–µ',
          empty: '–ë–æ—Å',
          noOrders: '–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –∂–æ“õ',
          orderSuccess: '–¢–∞–ø—Å—ã—Ä—ã—Å “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã! –¢”©–ª–µ–º —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç —á–∞—Ç“õ–∞ –∫–µ–ª–µ–¥—ñ üí¨',
          details: '–¢–æ–ª—ã“ì—ã—Ä–∞“õ',
          back: '–ê—Ä—Ç“õ–∞',
          cashback: '–ö—ç—à–±–µ–∫',
          balance: '–ë–∞–ª–∞–Ω—Å',
          history: '–¢–∞—Ä–∏—Ö',
          useCashback: '–ö—ç—à–±–µ–∫—Ç—ñ –ø–∞–π–¥–∞–ª–∞–Ω—É',
          myProfile: '–ú–µ–Ω—ñ“£ –ø—Ä–æ—Ñ–∏–ª—ñ–º',
          totalOrders: '–ë–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä',
          pickup: '”®–∑—ñ–º –∞–ª—É',
          delivery: '–ñ–µ—Ç–∫—ñ–∑—É',
          address: '–ñ–µ—Ç–∫—ñ–∑—É –º–µ–∫–µ–Ω–∂–∞–π—ã',
          deliveryDate: '–ñ–µ—Ç–∫—ñ–∑—É –∫“Ø–Ω—ñ',
          deliveryTime: '–ñ–µ—Ç–∫—ñ–∑—É —É–∞“õ—ã—Ç—ã',
          newItems: '–ñ–∞“£–∞–ª—ã“õ—Ç–∞—Ä'
        }
      };

      const t = translations[lang];

      useEffect(() => {
        if (tg) {
          tg.ready();
          tg.expand();
          
          const user = tg.initDataUnsafe?.user;
          if (user?.language_code === 'kk') {
            setLang('kk');
          }
        }

        initSupabase();
      }, []);

      const initSupabase = async () => {
        try {
          const configResponse = await fetch('/api/config');
          const config = await configResponse.json();
          
          const { createClient } = window.supabase;
          const client = createClient(config.supabaseUrl, config.supabaseKey);
          
          setSupabase(client);
          await loadData(client);
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
          setLoading(false);
        }
      };

      const loadData = async (client) => {
        try {
          const userId = tg?.initDataUnsafe?.user?.id;

          // ===== –ö–†–ò–¢–ò–ß–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) =====
          const criticalPromises = [
            // –¢–æ–≤–∞—Ä—ã
            client
              .from('flowers_products')
              .select('*')
              .eq('available', true)
              .order('created_at', { ascending: false }),
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            client
              .from('flowers_settings')
              .select('*')
              .eq('id', 1)
              .single()
          ];

          // –ï—Å–ª–∏ –µ—Å—Ç—å userId - –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–ª–∏–µ–Ω—Ç–∞
          if (userId) {
            criticalPromises.push(
              client
                .from('flowers_customers')
                .select('*')
                .eq('telegram_user_id', userId)
                .single()
            );
          }

          // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å—ë –∫—Ä–∏—Ç–∏—á–Ω–æ–µ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û
          const results = await Promise.all(criticalPromises);
          
          const productsData = results[0].data;
          const settingsData = results[1].data;
          const customerData = userId ? results[2]?.data : null;

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã
          setProducts(productsData || []);

          // –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
          const uniqueCategories = [...new Set(productsData?.map(p => p.category).filter(Boolean))];
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä—ã –º–ª–∞–¥—à–µ 3 –¥–Ω–µ–π
          const threeDaysAgo = new Date();
          threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
          
          const hasNewItems = productsData?.some(p => new Date(p.created_at) >= threeDaysAgo);
          
          // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤–∏–Ω–∫–∏ - –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –Ω–∞—á–∞–ª–æ
          if (hasNewItems) {
            setCategories(['new', ...uniqueCategories]);
          } else {
            setCategories(uniqueCategories);
          }
          
          setSettings(settingsData);
          setCustomer(customerData);

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –±–æ–ª—å—à–µ –Ω–µ –≥—Ä—É–∑–∏–º!
          setLoading(false);

          // ===== –õ–ï–ù–ò–í–ê–Ø –ó–ê–ì–†–£–ó–ö–ê (–≤ —Ñ–æ–Ω–µ) =====
          if (userId) {
            // –ó–∞–∫–∞–∑—ã –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥—Ä—É–∑–∏–º –≤ —Ñ–æ–Ω–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è UI
            Promise.all([
              client
                .from('flowers_orders')
                .select('*')
                .eq('telegram_user_id', userId)
                .order('created_at', { ascending: false }),
              
              client
                .from('flowers_cashback_transactions')
                .select('*')
                .eq('telegram_user_id', userId)
                .order('created_at', { ascending: false })
            ]).then(([ordersResult, transactionsResult]) => {
              setOrders(ordersResult.data || []);
              setCashbackTransactions(transactionsResult.data || []);
            }).catch(error => {
              console.error('–û—à–∏–±–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            });
          }
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
          setLoading(false);
        }
      };

      const showToast = (message, type = 'success') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 3000);
      };

      const addToCart = (product) => {
        const existing = cart.find(item => item.id === product.id);
        if (existing) {
          setCart(cart.map(item => 
            item.id === product.id 
              ? { ...item, quantity: item.quantity + 1 }
              : item
          ));
        } else {
          setCart([...cart, { ...product, quantity: 1 }]);
        }
        showToast(lang === 'kk' ? '–°–µ–±–µ—Ç–∫–µ “õ–æ—Å—ã–ª–¥—ã' : '–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
        tg?.HapticFeedback?.impactOccurred('light');
      };

      const updateQuantity = (productId, delta) => {
        setCart(cart.map(item => {
          if (item.id === productId) {
            const newQuantity = item.quantity + delta;
            return newQuantity > 0 ? { ...item, quantity: newQuantity } : item;
          }
          return item;
        }).filter(item => item.quantity > 0));
      };

      const removeFromCart = (productId) => {
        setCart(cart.filter(item => item.id !== productId));
        showToast(lang === 'kk' ? '–°–µ–±–µ—Ç—Ç–µ–Ω ”©—à—ñ—Ä—ñ–ª–¥—ñ' : '–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
      };

      const reorder = (order) => {
        setCart(order.items);
        setView('cart');
        showToast(lang === 'kk' ? '–¢–∞–ø—Å—ã—Ä—ã—Å —Å–µ–±–µ—Ç–∫–µ “õ–æ—Å—ã–ª–¥—ã' : '–ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
        tg?.HapticFeedback?.impactOccurred('medium');
      };

      const getCartSubtotal = () => {
        return cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      };

      const getTotalPrice = () => {
        const cartTotal = getCartSubtotal();
        if (useCashback && customer && customer.cashback_balance > 0) {
          const discount = Math.min(cashbackAmount, customer.cashback_balance, cartTotal);
          return Math.max(0, cartTotal - discount);
        }
        return cartTotal;
      };

      const submitOrder = async () => {
        if (cart.length === 0) {
          showToast(lang === 'kk' ? '–°–µ–±–µ—Ç –±–æ—Å' : '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞', 'error');
          return;
        }
        
        const name = document.getElementById('customerName')?.value?.trim();
        const phone = document.getElementById('customerPhone')?.value?.replace(/\s/g, '').trim(); // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
        const comment = document.getElementById('customerComment')?.value?.trim();
        
        // –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
        const deliveryAddress = document.getElementById('deliveryAddress')?.value?.trim();
        const deliveryDate = document.getElementById('deliveryDate')?.value;
        const deliveryTime = document.getElementById('deliveryTime')?.value;
        
        if (!name || !phone) {
          showToast(lang === 'kk' ? '–¢–æ–ª—Ç—ã—Ä—ã“£—ã–∑ –±–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
          return;
        }
        
        if (deliveryType === 'delivery' && (!deliveryAddress || !deliveryDate || !deliveryTime)) {
          showToast(lang === 'kk' ? '–ñ–µ—Ç–∫—ñ–∑—É –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ–Ω —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏', 'error');
          return;
        }
        
        try {
          const orderId = Math.floor(10000 + Math.random() * 90000).toString(); // 5-–∑–Ω–∞—á–Ω—ã–π –Ω–æ–º–µ—Ä: 10000-99999
          const userId = tg?.initDataUnsafe?.user?.id;
          const username = tg?.initDataUnsafe?.user?.username;
          
          const subtotal = getCartSubtotal();
          const cashbackUsed = useCashback ? Math.min(cashbackAmount, customer.cashback_balance, subtotal) : 0;
          const finalTotal = subtotal - cashbackUsed;
          
          await supabase.from('flowers_orders').insert({
            id: orderId,
            telegram_user_id: userId,
            customer_name: name,
            customer_phone: phone,
            comment: comment,
            delivery_type: deliveryType,
            delivery_address: deliveryType === 'delivery' ? deliveryAddress : null,
            delivery_date: deliveryType === 'delivery' ? deliveryDate : null,
            delivery_time: deliveryType === 'delivery' ? deliveryTime : null,
            items: cart,
            subtotal: subtotal,
            cashback_used: cashbackUsed,
            total: finalTotal,
            status: 'pending'
          });
          
          if (cashbackUsed > 0) {
            const newBalance = customer.cashback_balance - cashbackUsed;
            
            await supabase
              .from('flowers_customers')
              .update({ cashback_balance: newBalance })
              .eq('telegram_user_id', userId);
            
            await supabase
              .from('flowers_cashback_transactions')
              .insert({
                telegram_user_id: userId,
                order_id: orderId,
                type: 'spent',
                amount: cashbackUsed,
                balance_after: newBalance
              });
          }
          
          await fetch('/api/send-order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              orderId,
              date: new Date().toISOString(),
              customerName: name,
              customerPhone: phone,
              customerComment: comment,
              deliveryType: deliveryType,
              deliveryAddress: deliveryType === 'delivery' ? deliveryAddress : null,
              deliveryDate: deliveryType === 'delivery' ? deliveryDate : null,
              deliveryTime: deliveryType === 'delivery' ? deliveryTime : null,
              telegramUserId: userId,
              telegramUsername: username,
              items: cart,
              subtotal: subtotal,
              cashbackUsed: cashbackUsed,
              total: finalTotal,
              paymentEnabled: settings?.payment_enabled || false,
              kaspiPhone: settings?.kaspi_phone,
              kaspiLink: settings?.kaspi_link
            })
          });
          
          setCart([]);
          setUseCashback(false);
          setCashbackAmount(0);
          setView('orders');
          showToast(t.orderSuccess);
          loadData(supabase);
          
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–∫–∞–∑–∞:', error);
          showToast(lang === 'kk' ? '“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã' : '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
        }
      };

      const filteredProducts = selectedCategory === 'all' 
        ? products 
        : selectedCategory === 'new'
        ? (() => {
            const threeDaysAgo = new Date();
            threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
            return products.filter(p => new Date(p.created_at) >= threeDaysAgo);
          })()
        : products.filter(p => p.category === selectedCategory);
      
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
      const searchedProducts = searchQuery.trim() 
        ? filteredProducts.filter(p => 
            p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
            p.name_kk?.toLowerCase().includes(searchQuery.toLowerCase()) ||
            p.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||
            p.description_kk?.toLowerCase().includes(searchQuery.toLowerCase())
          )
        : filteredProducts;

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <div className="text-center">
              <div className="text-6xl mb-4 animate-bounce">üå∏</div>
              <p className="text-gray-600 font-medium">{lang === 'kk' ? '–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...' : '–ó–∞–≥—Ä—É–∑–∫–∞...'}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 pb-20">
          {/* –•–µ–¥–µ—Ä —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º —è–∑—ã–∫–∞ */}
          <div className="bg-white border-b border-gray-200 p-4 sticky top-0 z-10">
            <div className="flex items-center justify-between">
              <h1 className="text-xl font-bold text-gray-900">
                {lang === 'kk' ? '–ì“Ø–ª –î“Ø–∫–µ–Ω—ñ' : '–¶–≤–µ—Ç–æ—á–Ω–∞—è –õ–∞–≤–∫–∞'}
              </h1>
              <div className="flex gap-2">
                <button
                  onClick={() => setLang('ru')}
                  className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                    lang === 'ru' ? 'bg-black text-white' : 'bg-gray-200 text-gray-700'
                  }`}
                >
                  RU
                </button>
                <button
                  onClick={() => setLang('kk')}
                  className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                    lang === 'kk' ? 'bg-black text-white' : 'bg-gray-200 text-gray-700'
                  }`}
                >
                  KK
                </button>
              </div>
            </div>
          </div>

          {/* –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ */}
          {selectedProduct && (
            <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end animate-fadeIn">
              <div className="bg-white w-full rounded-t-3xl max-h-[90vh] overflow-y-auto animate-slideUp">
                <div className="p-4">
                  <button
                    onClick={() => setSelectedProduct(null)}
                    className="mb-4 text-gray-600 flex items-center gap-2"
                  >
                    ‚Üê {t.back}
                  </button>
                  
                  {selectedProduct.image_url ? (
                    <img 
                      src={selectedProduct.image_url} 
                      alt={selectedProduct.name}
                      loading="lazy"
                      className="w-full h-80 object-cover rounded-2xl mb-4"
                    />
                  ) : (
                    <div className="w-full h-80 bg-gray-100 rounded-2xl flex items-center justify-center mb-4">
                      <span className="text-8xl">üå∫</span>
                    </div>
                  )}
                  
                  {/* –ë–µ–π–¥–∂ –Ω–æ–≤–∏–Ω–∫–∞ –∏–ª–∏ –∏–∑ –ë–î */}
                  {(() => {
                    const threeDaysAgo = new Date();
                    threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                    const isNew = new Date(selectedProduct.created_at) >= threeDaysAgo;
                    
                    const badge = isNew ? 'new' : selectedProduct.badge;
                    
                    return badge ? (
                      <div className={`inline-block text-xs px-3 py-1 rounded-full mb-3 ${
                        badge === 'new' 
                          ? 'bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg' 
                          : 'bg-black text-white'
                      }`}>
                        {badge === 'new' ? (lang === 'kk' ? 'üéâ –ñ–∞“£–∞' : 'üéâ –ù–æ–≤–∏–Ω–∫–∞') :
                         badge === 'hit' ? (lang === 'kk' ? '‚≠ê –¢–∞–Ω—ã–º–∞–ª' : '‚≠ê –•–∏—Ç') :
                         badge}
                      </div>
                    ) : null;
                  })()}
                  
                  <h2 className="text-2xl font-bold text-gray-900 mb-2">
                    {lang === 'kk' ? (selectedProduct.name_kk || selectedProduct.name) : selectedProduct.name}
                  </h2>
                  
                  <p className="text-gray-600 mb-4">
                    {lang === 'kk' ? (selectedProduct.description_kk || selectedProduct.description) : selectedProduct.description}
                  </p>
                  
                  <div className="flex items-center justify-between mb-4 p-4 bg-gray-100 rounded-xl">
                    <span className="text-sm text-gray-600">
                      {lang === 'kk' ? '–ö–∞—Ç–µ–≥–æ—Ä–∏—è:' : '–ö–∞—Ç–µ–≥–æ—Ä–∏—è:'}
                    </span>
                    <span className="font-medium">
                      {lang === 'kk' ? (selectedProduct.category_kk || selectedProduct.category) : selectedProduct.category}
                    </span>
                  </div>
                  
                  <div className="flex items-center justify-between mb-6">
                    <span className="text-3xl font-bold text-gray-900">
                      {selectedProduct.price} ‚Ç∏
                    </span>
                  </div>
                  
                  <button
                    onClick={() => {
                      addToCart(selectedProduct);
                      setSelectedProduct(null);
                    }}
                    className="w-full bg-black text-white py-4 rounded-xl font-bold text-lg"
                  >
                    {t.addToCart}
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* –ö–∞—Ç–∞–ª–æ–≥ */}
          {view === 'catalog' && (
            <div className="p-4">
              {/* –ü–æ–∏—Å–∫ */}
              <div className="mb-4">
                <div className="relative">
                  <input
                    type="text"
                    placeholder={lang === 'kk' ? '–Ü–∑–¥–µ—É...' : '–ü–æ–∏—Å–∫...'}
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-20"
                  />
                  <div className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl">
                    üîç
                  </div>
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                    >
                      ‚úï
                    </button>
                  )}
                </div>
              </div>
              
              {/* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */}
              <div className="category-scroll flex gap-2 mb-4 pb-2">
                <button
                  onClick={() => setSelectedCategory('all')}
                  className={`px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium transition-all ${
                    selectedCategory === 'all'
                      ? 'bg-black text-white'
                      : 'bg-white border border-gray-300 text-gray-700'
                  }`}
                >
                  {t.allCategories}
                </button>
                {categories.map(category => (
                  <button
                    key={category}
                    onClick={() => setSelectedCategory(category)}
                    className={`px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium transition-all ${
                      selectedCategory === category
                        ? category === 'new'
                          ? 'bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg'
                          : 'bg-black text-white'
                        : category === 'new'
                        ? 'bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 text-green-700'
                        : 'bg-white border border-gray-300 text-gray-700'
                    }`}
                  >
                    {category === 'new' ? `üéâ ${t.newItems}` : category}
                  </button>
                ))}
              </div>

              {/* –¢–æ–≤–∞—Ä—ã */}
              <div className="grid grid-cols-2 gap-3">
                {searchedProducts.length === 0 ? (
                  <div className="col-span-2 text-center py-12">
                    <div className="text-6xl mb-4">üîç</div>
                    <p className="text-gray-500">
                      {lang === 'kk' ? '–ï—à—Ç–µ“£–µ —Ç–∞–±—ã–ª–º–∞–¥—ã' : '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ'}
                    </p>
                  </div>
                ) : (
                  searchedProducts.map(product => (
                  <div 
                    key={product.id} 
                    className="card rounded-xl overflow-hidden cursor-pointer"
                    onClick={() => setSelectedProduct(product)}
                  >
                    <div className="relative h-40 bg-gray-100">
                      {product.image_url ? (
                        <img 
                          src={product.image_url} 
                          alt={product.name}
                          loading="lazy"
                          className="w-full h-full object-cover"
                        />
                      ) : (
                        <div className="w-full h-full flex items-center justify-center text-5xl">
                          üå∫
                        </div>
                      )}
                      {/* –ë–µ–π–¥–∂ –Ω–æ–≤–∏–Ω–∫–∞ –∏–ª–∏ –∏–∑ –ë–î */}
                      {(() => {
                        const threeDaysAgo = new Date();
                        threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                        const isNew = new Date(product.created_at) >= threeDaysAgo;
                        
                        const badge = isNew ? 'new' : product.badge;
                        
                        return badge ? (
                          <div className={`absolute top-2 right-2 text-xs px-2 py-1 rounded-full font-bold ${
                            badge === 'new' 
                              ? 'bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg' 
                              : 'bg-black text-white'
                          }`}>
                            {badge === 'new' ? (lang === 'kk' ? 'üéâ –ñ–∞“£–∞' : 'üéâ –ù–æ–≤–∏–Ω–∫–∞') :
                             badge === 'hit' ? (lang === 'kk' ? '‚≠ê –¢–∞–Ω—ã–º–∞–ª' : '‚≠ê –•–∏—Ç') :
                             badge}
                          </div>
                        ) : null;
                      })()}
                    </div>
                    
                    <div className="p-3">
                      <h3 className="font-semibold text-gray-900 text-sm mb-1 line-clamp-2">
                        {lang === 'kk' ? (product.name_kk || product.name) : product.name}
                      </h3>
                      <div className="flex items-center justify-between">
                        <span className="text-lg font-bold text-gray-900">
                          {product.price} ‚Ç∏
                        </span>
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            addToCart(product);
                          }}
                          className="bg-black text-white px-3 py-1.5 rounded-lg text-xs font-medium"
                        >
                          +
                        </button>
                      </div>
                    </div>
                  </div>
                ))
                )}
              </div>
            </div>
          )}

          {/* –ö–æ—Ä–∑–∏–Ω–∞ */}
          {view === 'cart' && (
            <div className="p-4">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">üõí {t.cart}</h2>
              
              {cart.length === 0 ? (
                <div className="text-center py-20">
                  <div className="text-6xl mb-4">üå∏</div>
                  <p className="text-gray-500 mb-4">{t.empty}</p>
                  <button
                    onClick={() => setView('catalog')}
                    className="bg-black text-white px-6 py-3 rounded-xl font-medium"
                  >
                    {lang === 'kk' ? '–ö–∞—Ç–∞–ª–æ–≥“õ–∞ –æ—Ä–∞–ª—É' : '–ö –∫–∞—Ç–∞–ª–æ–≥—É'}
                  </button>
                </div>
              ) : (
                <div className="space-y-3 mb-20">
                  {cart.map(item => (
                    <div key={item.id} className="bg-white rounded-xl p-4 border border-gray-200">
                      <div className="flex gap-3">
                        <div className="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                          {item.image_url ? (
                            <img src={item.image_url} alt={item.name} className="w-full h-full object-cover rounded-lg"/>
                          ) : (
                            <span className="text-3xl">üå∫</span>
                          )}
                        </div>
                        <div className="flex-1">
                          <h3 className="font-semibold text-gray-900 text-sm">
                            {lang === 'kk' ? (item.name_kk || item.name) : item.name}
                          </h3>
                          <p className="text-gray-900 font-bold">{item.price} ‚Ç∏</p>
                          <div className="flex items-center gap-3 mt-2">
                            <button
                              onClick={() => updateQuantity(item.id, -1)}
                              className="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center font-bold text-gray-600"
                            >
                              -
                            </button>
                            <span className="font-semibold">{item.quantity}</span>
                            <button
                              onClick={() => updateQuantity(item.id, 1)}
                              className="w-8 h-8 bg-black text-white rounded-lg flex items-center justify-center font-bold"
                            >
                              +
                            </button>
                            <button
                              onClick={() => removeFromCart(item.id)}
                              className="ml-auto text-red-500 text-sm"
                            >
                              üóëÔ∏è
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                  
                  {/* –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ */}
                  <div className="space-y-3">
                    {/* –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ */}
                    <div className="bg-white rounded-xl p-4 border border-gray-200">
                      <h3 className="font-semibold text-gray-900 mb-3">
                        üë§ {lang === 'kk' ? '–ë–∞–π–ª–∞–Ω—ã—Å –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ' : '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'}
                      </h3>
                      <div className="space-y-3">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            {t.name}
                          </label>
                          <input
                            id="customerName"
                            type="text"
                            placeholder={lang === 'kk' ? '–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑' : '–í–∞—à–µ –∏–º—è'}
                            className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-20"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            {t.phone}
                          </label>
                          <div className="relative">
                            <div className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-900 font-semibold text-lg pointer-events-none">
                              +7
                            </div>
                            <input
                              id="customerPhone"
                              type="tel"
                              placeholder="777 123 45 67"
                              className="w-full pl-14 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-20 text-lg"
                              onInput={(e) => {
                                let value = e.target.value.replace(/\D/g, '');
                                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 10 —Ü–∏—Ñ—Ä–∞–º–∏
                                value = value.slice(0, 10);
                                
                                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
                                if (value.length > 3 && value.length <= 6) {
                                  value = value.slice(0, 3) + ' ' + value.slice(3);
                                } else if (value.length > 6 && value.length <= 8) {
                                  value = value.slice(0, 3) + ' ' + value.slice(3, 6) + ' ' + value.slice(6);
                                } else if (value.length > 8) {
                                  value = value.slice(0, 3) + ' ' + value.slice(3, 6) + ' ' + value.slice(6, 8) + ' ' + value.slice(8, 10);
                                }
                                e.target.value = value;
                              }}
                            />
                          </div>
                          <p className="text-xs text-gray-500 mt-1">
                            {lang === 'kk' ? '–ú—ã—Å–∞–ª—ã: 777 123 45 67' : '–ù–∞–ø—Ä–∏–º–µ—Ä: 777 123 45 67'}
                          </p>
                        </div>
                      </div>
                    </div>
                    
                    {/* –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ */}
                    <div className="bg-white rounded-xl p-4 border border-gray-200">
                      <h3 className="font-semibold text-gray-900 mb-3">
                        üì¶ {lang === 'kk' ? '–ê–ª—É ”ô–¥—ñ—Å—ñ' : '–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è'}
                      </h3>
                      <div className="grid grid-cols-2 gap-3">
                        <button
                          type="button"
                          onClick={() => setDeliveryType('pickup')}
                          className={`p-4 rounded-xl font-medium transition-all text-center ${
                            deliveryType === 'pickup'
                              ? 'bg-black text-white shadow-lg'
                              : 'bg-gray-50 text-gray-700 border-2 border-gray-200 hover:border-gray-400'
                          }`}
                        >
                          <div className="text-3xl mb-2">üè™</div>
                          <div className="font-bold">{t.pickup}</div>
                          <div className="text-xs mt-1 opacity-80">
                            {lang === 'kk' ? '–î“Ø–∫–µ–Ω–Ω–µ–Ω' : '–ò–∑ –º–∞–≥–∞–∑–∏–Ω–∞'}
                          </div>
                        </button>
                        <button
                          type="button"
                          onClick={() => setDeliveryType('delivery')}
                          className={`p-4 rounded-xl font-medium transition-all text-center ${
                            deliveryType === 'delivery'
                              ? 'bg-black text-white shadow-lg'
                              : 'bg-gray-50 text-gray-700 border-2 border-gray-200 hover:border-gray-400'
                          }`}
                        >
                          <div className="text-3xl mb-2">üöö</div>
                          <div className="font-bold">{t.delivery}</div>
                          <div className="text-xs mt-1 opacity-80">
                            {lang === 'kk' ? '–ú–µ–∫–µ–Ω–∂–∞–π“ì–∞' : '–ü–æ –∞–¥—Ä–µ—Å—É'}
                          </div>
                        </button>
                      </div>
                    </div>
                    
                    {/* –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏ */}
                    {deliveryType === 'delivery' && (
                      <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border-2 border-blue-200 animate-slideUp">
                        <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                          <span className="text-2xl">üöö</span>
                          {lang === 'kk' ? '–ñ–µ—Ç–∫—ñ–∑—É –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ' : '–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏'}
                        </h3>
                        <div className="space-y-3">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              üìç {t.address}
                            </label>
                            <input
                              id="deliveryAddress"
                              type="text"
                              placeholder={lang === 'kk' ? '–ö”©—à–µ, “Ø–π, –ø”ô—Ç–µ—Ä' : '–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞'}
                              className="w-full px-4 py-3 border border-blue-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20 bg-white"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              üìÖ {t.deliveryDate}
                            </label>
                            <div className="relative">
                              <input
                                id="deliveryDate"
                                type="date"
                                min={new Date().toISOString().split('T')[0]}
                                className="w-full px-4 py-3 border border-blue-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20 bg-white text-lg appearance-none"
                                style={{colorScheme: 'light'}}
                              />
                              <div className="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-blue-500">
                                üìÖ
                              </div>
                            </div>
                            <p className="text-xs text-blue-700 mt-1">
                              {lang === 'kk' ? '–ñ–µ—Ç–∫—ñ–∑—É –∫“Ø–Ω—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–æ—Å—Ç–∞–≤–∫–∏'}
                            </p>
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              ‚è∞ {t.deliveryTime}
                            </label>
                            <div className="relative">
                              <input
                                id="deliveryTime"
                                type="time"
                                className="w-full px-4 py-3 border border-blue-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20 bg-white text-lg appearance-none"
                                style={{colorScheme: 'light'}}
                              />
                              <div className="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-blue-500">
                                ‚è∞
                              </div>
                            </div>
                            <p className="text-xs text-blue-700 mt-1">
                              {lang === 'kk' ? '–ñ–µ—Ç–∫—ñ–∑—É —É–∞“õ—ã—Ç—ã–Ω —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏'}
                            </p>
                          </div>
                        </div>
                      </div>
                    )}
                    
                    {/* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π */}
                    <div className="bg-white rounded-xl p-4 border border-gray-200">
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        üí¨ {t.comment} ({lang === 'kk' ? '–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å' : '–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ'})
                      </label>
                      <textarea
                        id="customerComment"
                        placeholder={lang === 'kk' ? '–¢–∞–ø—Å—ã—Ä—ã—Å—ã“£—ã–∑ —Ç—É—Ä–∞–ª—ã “õ–æ—Å—ã–º—à–∞ –∞“õ–ø–∞—Ä–∞—Ç...' : '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ...'}
                        rows="3"
                        className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-20"
                      />
                    </div>
                  </div>
                  
                  {/* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–±–µ–∫–∞ */}
                  {customer && customer.cashback_balance > 0 && (
                    <div className="bg-gray-100 border-2 border-gray-300 rounded-xl p-4">
                      <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-2">
                          <input
                            type="checkbox"
                            id="useCashback"
                            checked={useCashback}
                            onChange={(e) => {
                              setUseCashback(e.target.checked);
                              if (e.target.checked) {
                                setCashbackAmount(Math.min(customer.cashback_balance, getCartSubtotal()));
                              } else {
                                setCashbackAmount(0);
                              }
                            }}
                            className="w-5 h-5"
                          />
                          <label htmlFor="useCashback" className="font-semibold text-gray-900">
                            {t.useCashback}
                          </label>
                        </div>
                        <span className="font-bold text-gray-900">
                          {customer.cashback_balance} ‚Ç∏
                        </span>
                      </div>
                      
                      {useCashback && (
                        <div>
                          <label className="block text-sm text-gray-700 mb-2">
                            {lang === 'kk' ? '“ö–∞–Ω—à–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É?' : '–°–∫–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?'}
                          </label>
                          <input
                            type="range"
                            min="0"
                            max={Math.min(customer.cashback_balance, getCartSubtotal())}
                            value={cashbackAmount}
                            onChange={(e) => setCashbackAmount(parseInt(e.target.value))}
                            className="w-full"
                          />
                          <div className="flex justify-between text-sm text-gray-600 mt-1">
                            <span>0 ‚Ç∏</span>
                            <span className="font-bold text-black">{cashbackAmount} ‚Ç∏</span>
                            <span>{Math.min(customer.cashback_balance, getCartSubtotal())} ‚Ç∏</span>
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                  
                  {/* –ò—Ç–æ–≥–æ */}
                  <div className="bg-black rounded-xl p-4 text-white">
                    {useCashback && cashbackAmount > 0 && (
                      <div className="mb-3 pb-3 border-b border-gray-700">
                        <div className="flex justify-between text-sm mb-1">
                          <span>{lang === 'kk' ? '–ê—Ä–∞–ª—ã“õ —Å–æ–º–∞:' : '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∏—Ç–æ–≥:'}</span>
                          <span>{getCartSubtotal()} ‚Ç∏</span>
                        </div>
                        <div className="flex justify-between text-sm">
                          <span>{lang === 'kk' ? '–ö—ç—à–±–µ–∫ –∂–µ“£—ñ–ª–¥—ñ–≥—ñ:' : '–°–∫–∏–¥–∫–∞ –∫—ç—à–±–µ–∫:'}</span>
                          <span className="text-green-400">-{cashbackAmount} ‚Ç∏</span>
                        </div>
                      </div>
                    )}
                    <div className="flex justify-between items-center mb-3">
                      <span className="text-lg">{t.total}:</span>
                      <span className="text-2xl font-bold">{getTotalPrice()} ‚Ç∏</span>
                    </div>
                    <button
                      onClick={submitOrder}
                      className="w-full bg-white text-black py-3 rounded-xl font-bold text-lg"
                    >
                      {t.order}
                    </button>
                  </div>
                </div>
              )}

              {/* –û –º–∞–≥–∞–∑–∏–Ω–µ */}
              <div className="bg-white rounded-xl p-4 border border-gray-200 mt-4">
                <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                  üè™ {lang === 'kk' ? '–î“Ø–∫–µ–Ω —Ç—É—Ä–∞–ª—ã' : '–û –º–∞–≥–∞–∑–∏–Ω–µ'}
                </h3>
                <div className="space-y-3 text-sm">
                  {settings?.contact_address && (
                    <div className="flex items-start gap-3">
                      <span className="text-xl">üìç</span>
                      <div>
                        <p className="font-medium text-gray-900">
                          {lang === 'kk' ? '–ú–µ–∫–µ–Ω–∂–∞–π' : '–ê–¥—Ä–µ—Å'}
                        </p>
                        <p className="text-gray-600">{settings.contact_address}</p>
                      </div>
                    </div>
                  )}
                  
                  {settings?.working_hours && (
                    <div className="flex items-start gap-3">
                      <span className="text-xl">‚è∞</span>
                      <div>
                        <p className="font-medium text-gray-900">
                          {lang === 'kk' ? '–ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã' : '–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã'}
                        </p>
                        <p className="text-gray-600">{settings.working_hours}</p>
                      </div>
                    </div>
                  )}
                  
                  {settings?.contact_phone && (
                    <div className="flex items-start gap-3">
                      <span className="text-xl">üìû</span>
                      <div>
                        <p className="font-medium text-gray-900">
                          {lang === 'kk' ? '–¢–µ–ª–µ—Ñ–æ–Ω' : '–¢–µ–ª–µ—Ñ–æ–Ω'}
                        </p>
                        <a href={`tel:${settings.contact_phone}`} className="text-gray-600 hover:text-black">
                          {settings.contact_phone}
                        </a>
                      </div>
                    </div>
                  )}
                  
                  {settings?.instagram && (
                    <div className="flex items-start gap-3">
                      <span className="text-xl">üì∑</span>
                      <div>
                        <p className="font-medium text-gray-900">Instagram</p>
                        <a 
                          href={`https://instagram.com/${settings.instagram.replace('@', '')}`} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          className="text-gray-600 hover:text-black"
                        >
                          {settings.instagram}
                        </a>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* –ó–∞–∫–∞–∑—ã */}
          {view === 'orders' && (
            <div className="p-4">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">üìã {t.orders}</h2>
              
              {orders.length === 0 ? (
                <div className="text-center py-20">
                  <div className="text-6xl mb-4">üå∑</div>
                  <p className="text-gray-500">{t.noOrders}</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {orders.map(order => (
                    <div key={order.id} className="bg-white rounded-xl p-4 border border-gray-200">
                      <div className="flex justify-between items-start mb-3">
                        <div>
                          <p className="font-semibold text-gray-900">
                            {lang === 'kk' ? '–¢–∞–ø—Å—ã—Ä—ã—Å' : '–ó–∞–∫–∞–∑'} #{order.id}
                          </p>
                          <p className="text-sm text-gray-500">
                            {new Date(order.created_at).toLocaleDateString('ru-RU')}
                          </p>
                        </div>
                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                          order.status === 'delivered' ? 'bg-green-100 text-green-700' :
                          order.status === 'ready' ? 'bg-blue-100 text-blue-700' :
                          order.status === 'processing' ? 'bg-yellow-100 text-yellow-700' :
                          order.status === 'cancelled' ? 'bg-red-100 text-red-700' :
                          'bg-gray-100 text-gray-700'
                        }`}>
                          {order.status === 'pending' ? (lang === 'kk' ? '–ö“Ø—Ç—ñ–ª—É–¥–µ' : '–û–∂–∏–¥–∞–µ—Ç') :
                           order.status === 'processing' ? (lang === 'kk' ? '–î–∞–π—ã–Ω–¥–∞–ª—É–¥–∞' : '–ì–æ—Ç–æ–≤–∏—Ç—Å—è') :
                           order.status === 'ready' ? (lang === 'kk' ? '–î–∞–π—ã–Ω' : '–ì–æ—Ç–æ–≤') :
                           order.status === 'delivered' ? (lang === 'kk' ? '–ñ–µ—Ç–∫—ñ–∑—ñ–ª–¥—ñ' : '–î–æ—Å—Ç–∞–≤–ª–µ–Ω') :
                           order.status === 'cancelled' ? (lang === 'kk' ? '–ñ–æ–π—ã–ª–¥—ã' : '–û—Ç–º–µ–Ω—ë–Ω') :
                           order.status}
                        </span>
                      </div>
                      <div className="text-sm text-gray-600 mb-2">
                        {order.items.map((item, idx) => (
                          <div key={idx}>
                            {item.name} x{item.quantity}
                          </div>
                        ))}
                      </div>
                      <p className="font-bold text-gray-900 mt-2">
                        {order.total} ‚Ç∏
                      </p>
                      
                      {/* –ö–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ */}
                      <button
                        onClick={() => reorder(order)}
                        className="w-full mt-3 bg-black text-white py-2 rounded-lg font-medium text-sm flex items-center justify-center gap-2"
                      >
                        üîÑ {lang === 'kk' ? '“ö–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å –±–µ—Ä—É' : '–ó–∞–∫–∞–∑–∞—Ç—å –µ—â—ë —Ä–∞–∑'}
                      </button>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* –ü—Ä–æ—Ñ–∏–ª—å */}
          {view === 'profile' && (
            <div className="p-4">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">üë§ {t.myProfile}</h2>
              
              {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ */}
              <div className="bg-white rounded-xl p-4 border border-gray-200 mb-4">
                <div className="flex items-center gap-4 mb-4">
                  <div className="w-16 h-16 bg-gray-900 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                    {customer?.first_name?.charAt(0) || '?'}
                  </div>
                  <div>
                    <h3 className="font-bold text-gray-900">{customer?.first_name || '–ö–ª–∏–µ–Ω—Ç'}</h3>
                    <p className="text-sm text-gray-500">
                      {t.totalOrders}: {customer?.total_orders || 0}
                    </p>
                  </div>
                </div>
              </div>

              {/* –ö—ç—à–±–µ–∫ */}
              <div className="bg-gradient-to-r from-gray-800 to-black rounded-xl p-6 text-white text-center mb-4">
                <p className="text-lg mb-2">{t.balance} {t.cashback}</p>
                <p className="text-5xl font-bold">{customer?.cashback_balance || 0} ‚Ç∏</p>
              </div>
              
              <div className="bg-white rounded-xl p-4 border border-gray-200 mb-4">
                <h3 className="font-semibold text-gray-900 mb-2">
                  {lang === 'kk' ? '–ö—ç—à–±–µ–∫ “õ–∞–ª–∞–π –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ?' : '–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—ç—à–±–µ–∫?'}
                </h3>
                <ul className="space-y-2 text-sm text-gray-600">
                  <li>‚Ä¢ {lang === 'kk' ? '”ò—Ä –∂–µ—Ç–∫—ñ–∑—ñ–ª–≥–µ–Ω —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞–Ω 5% –∫—ç—à–±–µ–∫' : '–ü–æ–ª—É—á–∞–π—Ç–µ 5% —Å –∫–∞–∂–¥–æ–≥–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞'}</li>
                  <li>‚Ä¢ {lang === 'kk' ? '–ö–µ–ª–µ—Å—ñ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É' : '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–∫–∞–∑–µ'}</li>
                  <li>‚Ä¢ {lang === 'kk' ? '–ñ–∏–Ω–∞“õ—Ç–∞–ª–∞–¥—ã –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ' : '–ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏'}</li>
                </ul>
              </div>
              
              {/* –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π */}
              {cashbackTransactions.length > 0 && (
                <div className="bg-white rounded-xl p-4 border border-gray-200">
                  <h3 className="font-semibold text-gray-900 mb-3">
                    {t.history}
                  </h3>
                  <div className="space-y-2">
                    {cashbackTransactions.map(transaction => (
                      <div key={transaction.id} className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                        <div className="flex items-center gap-3">
                          <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                            transaction.type === 'earned' ? 'bg-green-100' : 'bg-red-100'
                          }`}>
                            <span className="text-xl">
                              {transaction.type === 'earned' ? 'üí∞' : 'üõí'}
                            </span>
                          </div>
                          <div>
                            <p className="text-sm font-medium text-gray-900">
                              {transaction.type === 'earned' 
                                ? (lang === 'kk' ? '–ö—ç—à–±–µ–∫ –∂–∏–Ω–∞“õ—Ç–∞–ª–¥—ã' : '–ö—ç—à–±–µ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω')
                                : (lang === 'kk' ? '–ö—ç—à–±–µ–∫ –ø–∞–π–¥–∞–ª–∞–Ω—ã–ª–¥—ã' : '–ö—ç—à–±–µ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω')}
                            </p>
                            <p className="text-xs text-gray-500">
                              {new Date(transaction.created_at).toLocaleDateString('ru-RU')}
                            </p>
                          </div>
                        </div>
                        <div className="text-right">
                          <p className={`font-bold ${
                            transaction.type === 'earned' ? 'text-green-600' : 'text-red-600'
                          }`}>
                            {transaction.type === 'earned' ? '+' : '-'}{transaction.amount} ‚Ç∏
                          </p>
                          <p className="text-xs text-gray-400">
                            {lang === 'kk' ? '–ë–∞–ª–∞–Ω—Å:' : '–ë–∞–ª–∞–Ω—Å:'} {transaction.balance_after} ‚Ç∏
                          </p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Toast */}
          {toast && (
            <div className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 animate-fadeIn max-w-sm w-full px-4">
              <div className={`${
                toast.type === 'success' ? 'bg-black' : 'bg-red-500'
              } text-white px-6 py-4 rounded-2xl shadow-2xl`}>
                <div className="flex items-center gap-3">
                  <span className="text-2xl">
                    {toast.type === 'success' ? '‚úì' : '‚úï'}
                  </span>
                  <p className="font-medium">{toast.message}</p>
                </div>
              </div>
            </div>
          )}

          {/* Bottom Navigation */}
          <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 z-20">
            <button
              onClick={() => setView('catalog')}
              className={`flex flex-col items-center gap-1 px-4 py-2 ${
                view === 'catalog' ? 'text-black' : 'text-gray-400'
              }`}
            >
              <span className="text-2xl">üè†</span>
              <span className="text-xs font-medium">{t.catalog}</span>
            </button>
            
            <button
              onClick={() => setView('cart')}
              className={`flex flex-col items-center gap-1 px-4 py-2 relative ${
                view === 'cart' ? 'text-black' : 'text-gray-400'
              }`}
            >
              <span className="text-2xl">üõí</span>
              {cart.length > 0 && (
                <span className="absolute top-1 right-2 bg-black text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold">
                  {cart.length}
                </span>
              )}
              <span className="text-xs font-medium">{t.cart}</span>
            </button>
            
            <button
              onClick={() => setView('orders')}
              className={`flex flex-col items-center gap-1 px-4 py-2 ${
                view === 'orders' ? 'text-black' : 'text-gray-400'
              }`}
            >
              <span className="text-2xl">üìã</span>
              <span className="text-xs font-medium">{t.orders}</span>
            </button>
            
            <button
              onClick={() => setView('profile')}
              className={`flex flex-col items-center gap-1 px-4 py-2 ${
                view === 'profile' ? 'text-black' : 'text-gray-400'
              }`}
            >
              <span className="text-2xl">üë§</span>
              <span className="text-xs font-medium">{t.profile}</span>
            </button>
          </div>
        </div>
      );
    };

    ReactDOM.render(<FlowerShop />, document.getElementById('root'));
  </script>
</body>
</html>
